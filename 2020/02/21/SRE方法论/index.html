<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>SRE方法论 | ChpiTer Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="方法论1. 确保长期关注运维研发工作 最多 50% 的运维值班内容，最少 50% 的运维开发内容 控制处理紧急事件的数量，运维人员有充分时间处理故障、恢复服务以及事后进行复盘报告 事前报警，但是事后总结更加重要：复盘故障发生、报警和处理的全过程，挖掘故障发生的根本原因，提供相应的预防或解决方案，对事不对人  2. 产品稳定性和迭代速度之间的矛盾 可靠性目标 SLO 错误预算 利用错误预算，加快产品">
<meta property="og:type" content="article">
<meta property="og:title" content="SRE方法论">
<meta property="og:url" content="https://chpiter.github.io/2020/02/21/SRE%E6%96%B9%E6%B3%95%E8%AE%BA/index.html">
<meta property="og:site_name" content="ChpiTer Blog">
<meta property="og:description" content="方法论1. 确保长期关注运维研发工作 最多 50% 的运维值班内容，最少 50% 的运维开发内容 控制处理紧急事件的数量，运维人员有充分时间处理故障、恢复服务以及事后进行复盘报告 事前报警，但是事后总结更加重要：复盘故障发生、报警和处理的全过程，挖掘故障发生的根本原因，提供相应的预防或解决方案，对事不对人  2. 产品稳定性和迭代速度之间的矛盾 可靠性目标 SLO 错误预算 利用错误预算，加快产品">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://chpiter.github.io/images/1053682-20190527095123236-652009308.png">
<meta property="og:image" content="https://chpiter.github.io/images/1053682-20190527095313544-971610690.png">
<meta property="og:image" content="https://chpiter.github.io/images/1053682-20190527095414439-329213436.png">
<meta property="og:image" content="https://chpiter.github.io/images/1053682-20190527095443475-675603692.png">
<meta property="article:published_time" content="2020-02-21T10:34:30.000Z">
<meta property="article:modified_time" content="2024-04-12T06:27:42.689Z">
<meta property="article:author" content="ChpiTer">
<meta property="article:tag" content="SRE">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://chpiter.github.io/images/1053682-20190527095123236-652009308.png">
  
    <link rel="alternate" href="/atom.xml" title="ChpiTer Blog" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<meta name="generator" content="Hexo 7.1.1"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">ChpiTer Blog</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS 订阅"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="搜索"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="搜索"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://chpiter.github.io"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="sre-theory-SRE方法论" class="h-entry article article-type-sre-theory" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/02/21/SRE%E6%96%B9%E6%B3%95%E8%AE%BA/" class="article-date">
  <time class="dt-published" datetime="2020-02-21T10:34:30.000Z" itemprop="datePublished">2020-02-21</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      SRE方法论
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="方法论"><a href="#方法论" class="headerlink" title="方法论"></a>方法论</h1><h2 id="1-确保长期关注运维研发工作"><a href="#1-确保长期关注运维研发工作" class="headerlink" title="1. 确保长期关注运维研发工作"></a>1. 确保长期关注运维研发工作</h2><ul>
<li>最多 50% 的运维值班内容，最少 50% 的运维开发内容</li>
<li>控制处理紧急事件的数量，运维人员有充分时间处理故障、恢复服务以及事后进行复盘报告</li>
<li>事前报警，但是事后总结更加重要：复盘故障发生、报警和处理的全过程，挖掘故障发生的根本原因，提供相应的预防或解决方案，对事不对人</li>
</ul>
<h2 id="2-产品稳定性和迭代速度之间的矛盾"><a href="#2-产品稳定性和迭代速度之间的矛盾" class="headerlink" title="2. 产品稳定性和迭代速度之间的矛盾"></a>2. 产品稳定性和迭代速度之间的矛盾</h2><ul>
<li>可靠性目标 SLO</li>
<li>错误预算</li>
<li>利用错误预算，加快产品迭代速度，同时保证服务质量</li>
<li>最终目标不是“零事故”，而是在稳定和迭代之间寻求平衡，开发和运维之间协作创新</li>
</ul>
<h2 id="3-监控系统"><a href="#3-监控系统" class="headerlink" title="3. 监控系统"></a>3. 监控系统</h2><ul>
<li>紧急报警（alert） ：业务正常运行受到影响，需要紧急处理</li>
<li>工单（ticket）：业务不受影响，可以延期处理</li>
<li>日志（logging）：记录应用运行日志，用于调试和事后分析</li>
</ul>
<h2 id="4-应急事件处理"><a href="#4-应急事件处理" class="headerlink" title="4. 应急事件处理"></a>4. 应急事件处理</h2><ul>
<li>MTTF（平均失败时间）</li>
<li>MTTR（平均恢复时间）</li>
<li>自动恢复系统，而非需要人工干预，可减少恢复时间</li>
<li>运维手册（playbook）</li>
</ul>
<h2 id="5-变更管理"><a href="#5-变更管理" class="headerlink" title="5. 变更管理"></a>5. 变更管理</h2><ul>
<li>渐进式发布机制（<a target="_blank" rel="noopener" href="https://www.cnblogs.com/nulige/articles/10929182.html">几种常见的发布方式</a>：<ul>
<li>蓝绿发布（AB发布）<br>  将应用所在集群上的机器从逻辑上分为A&#x2F;B两组。在新版发布时，首先把A组的机器从负载均衡中摘除，再进行新版本的部署。此时，B组仍然继续提供服务。<br>  <img src="/images/1053682-20190527095123236-652009308.png"><br>  当A组升级完毕后，负载均衡重新接入A组，再把B组从负载列表中摘除，进行新版本的部署。A组重新提供服务。<br>  <img src="/images/1053682-20190527095313544-971610690.png"><br>  特点：<ul>
<li>如果出问题，影响面较广，或者说很难控制具体的影响面</li>
<li>发布策略简单</li>
<li>用户无感知，平滑过渡</li>
<li>升级&#x2F;回滚速度快<br>  缺点：</li>
<li>需要准备正常业务使用资源的两倍以上服务器，防止升级期间单组无法承载业务突发</li>
<li>短时间内浪费一定资源成本</li>
<li>基础设施无改动，增大升级稳定性<br>  蓝绿发布在早期物理服务器时代，还是比较昂贵的，由于云计算普及，成本也大大降低</li>
</ul>
</li>
<li>灰度发布<br>  灰度发布只升级部分服务，即让一部分用户继续用老版本，一部分用户开始用新版本，如果用户对新版本没什么意见，那么逐步扩大范围，把所有用户都迁移到新版本上面来。<br>  <img src="/images/1053682-20190527095414439-329213436.png"><br>  特点：<ul>
<li>保证整体系统稳定性，在初始灰度的时候就可以发现、调整问题，影响范围可控</li>
<li>新功能逐步评估性能，稳定性和健康状况，如果出问题影响范围很小，相对用户体验也少</li>
<li>用户无感知，平滑过渡<br>  缺点：</li>
<li>自动化要求高<br>  部署过程：</li>
<li>从LB摘掉灰度服务器，升级成功后再加入LB</li>
<li>少量用户流量到新版本</li>
<li>如果灰度服务器测试成功，升级剩余服务器<br>  灰度发布是通过切换线上并存版本之间的路由权重，逐步从一个版本切换为另一个版本的过程</li>
</ul>
</li>
<li>滚动发布<br>  滚动发布是指每次只升级一个或多个服务，升级完成后加入生产环境，不断执行这个过程，直到集群中的全部旧版本升级新版本。<br>  <img src="/images/1053682-20190527095443475-675603692.png"><ul>
<li>红色：正在更新的实例</li>
<li>蓝色：更新完成并加入集群的实例</li>
<li>绿色：正在运行的实例<br>  特点：</li>
<li>用户无感知，平滑过渡</li>
<li>节约资源<br>  缺点：</li>
<li>部署时间慢，取决于每阶段更新时间</li>
<li>发布策略较复杂</li>
<li>无法确定OK的环境，不易回滚<br>  部署过程：</li>
<li>先升级1个副本，主要做部署验证</li>
<li>每次升级副本，自动从LB上摘掉，升级成功后自动加入集群</li>
<li>事先需要有自动更新策略，分为若干次，每次数量&#x2F;百分比可配置</li>
<li>回滚是发布的逆过程，先从LB摘掉新版本，再升级老版本，这个过程一般时间比较长</li>
<li>自动化要求高</li>
</ul>
</li>
<li>小结<br>  综上所述，三种方式均可以做到平滑式升级，在升级过程中服务仍然保持服务的连续性，升级对外界是无感知的。那生产上选择哪种部署方法最合适呢？这取决于哪种方法最适合你的业务和技术需求。如果你们运维自动化能力储备不够，肯定是越简单越好，建议蓝绿发布，如果业务对用户依赖很强，建议灰度发布。如果是K8S平台，滚动更新是现成的方案，建议先直接使用<ul>
<li>蓝绿发布：两套环境交替升级，旧版本保留一定时间便于回滚</li>
<li>灰度发布：根据比例将老版本升级，例如80%用户访问是老版本，20%用户访问是新版本</li>
<li>滚动发布：按批次停止老版本实例，启动新版本实例</li>
</ul>
</li>
</ul>
</li>
<li>迅速而准确的检测到问题的发生</li>
<li>当出现问题时，安全迅速的回退改动</li>
</ul>
<h2 id="6-需求预测和容量规划"><a href="#6-需求预测和容量规划" class="headerlink" title="6. 需求预测和容量规划"></a>6. 需求预测和容量规划</h2><p>业务的容量规划，包括自然增长（随着用户使用量上升，资源使用量也上升），也包括一些非自然增长的因素（如新功能的发布，商业推广，以及其他商业因素在内）</p>
<ul>
<li>必须有一个准确的自然增长需求预测模型，需求预测的时间应该超过资源获取的时间</li>
<li>规划中必须有准确的非自然增长的需求来源的统计</li>
<li>必须有周期性的压力测试，以便准确的将系统原始资源信息与业务容量对应起来</li>
</ul>
<h2 id="7-资源部署"><a href="#7-资源部署" class="headerlink" title="7. 资源部署"></a>7. 资源部署</h2><p>资源部署是变更管理与容量规划的结合产物。</p>
<ul>
<li>资源部署和配置必须迅速完成</li>
<li>仅在必要的时候执行，因为资源有限且昂贵</li>
<li>保证部署和配置过程执行的正确性，否则资源不可用</li>
<li>部署和配置过程影响较大，会有较大幅度修改，必须执行一系列测试，确保可以正确的提供服务</li>
</ul>
<h2 id="8-效率与性能"><a href="#8-效率与性能" class="headerlink" title="8. 效率与性能"></a>8. 效率与性能</h2><ul>
<li>高效的利用资源，盈利的必要性</li>
<li>SRE负责容量的部署和配置，承担有关利用率的讨论和改进</li>
<li>服务的利用率指标依赖于服务的工作方式和对容量的配置与部署</li>
<li>关注服务的容量配置策略，提升资源利用率，可以有效的降低系统成本<br>业务总体资源的使用情况的关键驱动因素：<ul>
<li>用户需求</li>
<li>可用容量</li>
<li>软件的资源使用效率<br>SRE可以通过模型预测用户需求，合理部署和配置可用容量，同时可以改进软件以提升资源的使用效率。通过这三个因素可以大幅度提升服务的效率。<br>软件系统一般来说在负载上升的时候，会导致延迟升高。延迟升高其实和容量损失是一样的。当负载达到临界线的时候，一个逐渐变慢的系统最终会停止一切服务。SRE的目标是根据一个预设的延迟目标，部署和维护足够的容量。SRE和研发团队应该共同监控和优化整个系统的性能，这就相当于给服务增加容量和提升效率了。</li>
</ul>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://chpiter.github.io/2020/02/21/SRE%E6%96%B9%E6%B3%95%E8%AE%BA/" data-id="cluwce6q0000ykcuf2q9yeyds" data-title="SRE方法论" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SRE/" rel="tag">SRE</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2020/02/22/%E7%BA%AA%E5%BF%B5%E6%88%91%E7%9A%84%E7%88%B6%E4%BA%B2/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">前一篇</strong>
      <div class="article-nav-title">
        
          纪念我的父亲
        
      </div>
    </a>
  
  
    <a href="/2020/02/20/MarkDown%E5%B8%B8%E7%94%A8%E8%AF%AD%E6%B3%95/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">后一篇</strong>
      <div class="article-nav-title">MarkDown常用语法</div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/2fa/" rel="tag">2fa</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/BCM/" rel="tag">BCM</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DRP/" rel="tag">DRP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ITIL/" rel="tag">ITIL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MongoDB/" rel="tag">MongoDB</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MySQL/" rel="tag">MySQL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Nginx/" rel="tag">Nginx</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SRE/" rel="tag">SRE</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/http/" rel="tag">http</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/iptables/" rel="tag">iptables</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/k8s/" rel="tag">k8s</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/keepalive/" rel="tag">keepalive</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/kubeadm/" rel="tag">kubeadm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ldap/" rel="tag">ldap</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/" rel="tag">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/lvs/" rel="tag">lvs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/markdown/" rel="tag">markdown</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nginx/" rel="tag">nginx</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ops/" rel="tag">ops</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/supervisor/" rel="tag">supervisor</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tcp/" rel="tag">tcp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%AD%A6%E4%B9%A0/" rel="tag">学习</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%81%BE%E5%A4%87/" rel="tag">灾备</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%AE%A1%E7%90%86/" rel="tag">管理</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签云</h3>
    <div class="widget tagcloud">
      <a href="/tags/2fa/" style="font-size: 10px;">2fa</a> <a href="/tags/BCM/" style="font-size: 10px;">BCM</a> <a href="/tags/DRP/" style="font-size: 10px;">DRP</a> <a href="/tags/ITIL/" style="font-size: 10px;">ITIL</a> <a href="/tags/MongoDB/" style="font-size: 10px;">MongoDB</a> <a href="/tags/MySQL/" style="font-size: 13.33px;">MySQL</a> <a href="/tags/Nginx/" style="font-size: 13.33px;">Nginx</a> <a href="/tags/SRE/" style="font-size: 16.67px;">SRE</a> <a href="/tags/http/" style="font-size: 10px;">http</a> <a href="/tags/iptables/" style="font-size: 10px;">iptables</a> <a href="/tags/k8s/" style="font-size: 13.33px;">k8s</a> <a href="/tags/keepalive/" style="font-size: 10px;">keepalive</a> <a href="/tags/kubeadm/" style="font-size: 13.33px;">kubeadm</a> <a href="/tags/ldap/" style="font-size: 10px;">ldap</a> <a href="/tags/linux/" style="font-size: 13.33px;">linux</a> <a href="/tags/lvs/" style="font-size: 10px;">lvs</a> <a href="/tags/markdown/" style="font-size: 10px;">markdown</a> <a href="/tags/nginx/" style="font-size: 20px;">nginx</a> <a href="/tags/ops/" style="font-size: 10px;">ops</a> <a href="/tags/supervisor/" style="font-size: 10px;">supervisor</a> <a href="/tags/tcp/" style="font-size: 10px;">tcp</a> <a href="/tags/%E5%AD%A6%E4%B9%A0/" style="font-size: 10px;">学习</a> <a href="/tags/%E7%81%BE%E5%A4%87/" style="font-size: 10px;">灾备</a> <a href="/tags/%E7%AE%A1%E7%90%86/" style="font-size: 10px;">管理</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/04/">四月 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/04/">四月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">七月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">六月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">五月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">四月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">三月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">二月 2020</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2024/04/22/Configuring%20LDAP%20Authentication/">关于主机的LDAP认证配置过程</a>
          </li>
        
          <li>
            <a href="/2021/04/15/ceph/">ceph</a>
          </li>
        
          <li>
            <a href="/2021/04/15/%E8%87%AA%E5%8A%A8%E5%8C%96%E5%88%9B%E5%BB%BAOpenStack%E9%95%9C%E5%83%8F%E7%A0%94%E7%A9%B6/">自动化创建OpenStack镜像研究</a>
          </li>
        
          <li>
            <a href="/2021/04/11/itil-5/">细说ITIL的五个服务支持流程</a>
          </li>
        
          <li>
            <a href="/2020/07/15/DRP/">灾备切换</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2024 ChpiTer<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>